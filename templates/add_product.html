{% extends "base.html" %}
{% block content %}

<style>
.page {
    display: flex;
    justify-content: center;
    margin-top: 40px;
}

.card {
    background: white;
    width: 420px;
    padding: 30px;
    border-radius: 6px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    border-top: 6px solid #D40511;
    display: block;   /* force single layout */
}

.card h2 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #D40511;
    text-align: center;
}

label {
    display: block;
    margin-top: 15px;
    font-size: 14px;
    font-weight: bold;
    color: #333;
}

input, select {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 14px;
}


button {
    width: 100%;
    margin-top: 25px;
    padding: 12px;
    background-color: #D40511;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
}

textarea {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ddd;
}

button:hover {
    background-color: #b4040f;
}

.toggle-label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 15px;
    font-weight: bold;
    font-size: 14px;
}

.toggle-label input {
    display: none;
}

.toggle-slider {
    width: 46px;
    height: 24px;
    background: #ccc;
    border-radius: 20px;
    position: relative;
    cursor: pointer;
    transition: background 0.3s ease;
}

.toggle-slider::before {
    content: "";
    width: 18px;
    height: 18px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 3px;
    left: 4px;
    transition: transform 0.3s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.toggle-label input:checked + .toggle-slider {
    background: #D40511;
}

.toggle-label input:checked + .toggle-slider::before {
    transform: translateX(20px);
}

</style>

<div class="page">
    <div class="card">
        <h2>Add Product</h2>

        <form method="POST" enctype="multipart/form-data">

            <label>Article Number</label>
            <input type="text" name="article_number" required>

            <label>Product Name</label>
            <input type="text" name="name" required>

            <label>Description (optional)</label>
            <textarea name="description" rows="3"></textarea>

            <label>Assign to Job Roles</label>

            <select id="role_select">
                <option value="">Select role</option>
                {% for role in job_roles %}
                    <option value="{{ role.id }}">{{ role.name }}</option>
                {% endfor %}
            </select>

            <button type="button" id="add_role_btn">Add another role</button>

            <div id="selected_roles" style="margin-top:15px;"></div>

            <label>Type</label>
            <select name="type" id="product_type" required onchange="updateSizes()">

                <option value="">Select type</option>

                <option value="SHIRT">Shirt</option>
                <option value="PANTS">Pants</option>
                <option value="JACKET">Jacket</option>
                <option value="SHOES">Shoes</option>
                <option value="ACCESSORIES">Accessories</option>
                <option value="SWEATSHIRT">Sweatshirt</option>
                <option value="TROUSER">Trouser</option>
                <option value="VEST">Vest</option>
                <option value="HAT">Hat</option>
                <option value="BELT">Belt</option>
                <option value="SCARF">Scarf</option>
                <option value="SHORTS">Shorts</option>
                <option value="BALACLAVA">Balaclava</option>
                <option value="GLOVES">Gloves</option>

            </select>

            <label class="toggle-label">
                <span>One Size Only</span>
                <input type="checkbox" id="one_size_toggle" onchange="updateSizes()">
                <span class="toggle-slider"></span>
            </label>

            <div id="size_container"></div>

            <label>Product Image</label>
            <input type="file" name="image">

            <button type="submit">Add Product</button>
        </form>
    </div>
</div>

<script>
function updateSizes() {

    const type = document.getElementById("product_type").value;
    const toggle = document.getElementById("one_size_toggle");
    const container = document.getElementById("size_container");

    container.innerHTML = "";

    // ALWAYS reset toggle first
    toggle.disabled = false;

    // Force one size types
    const forcedOneSizeTypes = ["BALACLAVA", "ACCESSORIES", "SCARF"];

    if (forcedOneSizeTypes.includes(type)) {
        toggle.checked = true;
        toggle.disabled = true;
    }

    let sizes = [];

    if (toggle.checked) {
        sizes = ["OneSize"];
    } else {

        if (["SHIRT","JACKET","SWEATSHIRT","VEST"].includes(type)) {
            sizes = ["XS","S","M","L","XL","XXL","XXXL"];
        }

        if (["PANTS","TROUSER"].includes(type)) {
            sizes = ["28","30","32","34","36","38","40","42","44","46"];
        }

        if (type === "SHORTS") {
            sizes = ["XS","S","M","L","XL","XXL"];
        }

        if (type === "SHOES") {
            sizes = ["40","41","42","43","44","45","46"];
        }

        if (type === "GLOVES") {
            sizes = ["S","M","L","XL"];
        }

        if (type === "HAT") {
            sizes = ["S","M","L"];
        }

        if (type === "BELT") {
            sizes = ["80","85","90","95","100","105","110","115"];
        }
    }

    sizes.forEach(size => {
        container.innerHTML += `
            <label>${size}</label>
            <input type="number" name="size_${size}" min="0" value="0">
        `;
    });
}

const roleSelect = document.getElementById("role_select");
const selectedRolesContainer = document.getElementById("selected_roles");

document.getElementById("add_role_btn").addEventListener("click", function () {

    const roleId = roleSelect.value;
    const roleName = roleSelect.options[roleSelect.selectedIndex].text;

    if (!roleId) return;

    // Prevent duplicates
    if (selectedRolesContainer.querySelector(`input[value="${roleId}"]`)) return;

    const wrapper = document.createElement("div");
    wrapper.style.display = "flex";
    wrapper.style.justifyContent = "space-between";
    wrapper.style.alignItems = "center";
    wrapper.style.marginBottom = "6px";

    wrapper.innerHTML = `
        <span>${roleName}</span>
        <div>
            <input type="hidden" name="job_role_ids" value="${roleId}">
            <button type="button" class="remove-role-btn">Remove</button>
        </div>
    `;

    selectedRolesContainer.appendChild(wrapper);

    // Reset dropdown
    roleSelect.value = "";
});

selectedRolesContainer.addEventListener("click", function (e) {
    if (e.target.classList.contains("remove-role-btn")) {
        e.target.closest("div").parentElement.remove();
    }
});


</script>

{% endblock %}
